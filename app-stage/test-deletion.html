<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Deletion Functionality</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.danger {
            background: #dc3545;
        }
        .button.danger:hover {
            background: #c82333;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .data-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .data-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Deletion Functionality</h1>
        <p>This page tests the deletion functionality for candidates, formations, and payments.</p>
        
        <div class="status" id="status"></div>
        
        <h2>üìä Current Data Status</h2>
        <div class="data-display" id="dataStatus">
            <div class="data-item">
                <span>Candidates:</span>
                <span id="candidateCount">Loading...</span>
            </div>
            <div class="data-item">
                <span>Formations:</span>
                <span id="formationCount">Loading...</span>
            </div>
            <div class="data-item">
                <span>Payments:</span>
                <span id="paymentCount">Loading...</span>
            </div>
            <div class="data-item">
                <span>Sample Data Cleared:</span>
                <span id="sampleDataStatus">Loading...</span>
            </div>
        </div>
        
        <h2>üóëÔ∏è Test Deletion</h2>
        <div>
            <button class="button" onclick="testCandidateDeletion()">Test Candidate Deletion</button>
            <button class="button" onclick="testFormationDeletion()">Test Formation Deletion</button>
            <button class="button" onclick="testPaymentDeletion()">Test Payment Deletion</button>
        </div>
        
        <h2>üîÑ Data Management</h2>
        <div>
            <button class="button" onclick="clearSampleData()">Clear Sample Data</button>
            <button class="button" onclick="resetData()">Reset All Data</button>
            <button class="button" onclick="refreshData()">Refresh Data</button>
        </div>
        
        <h2>üìã Detailed Data</h2>
        <div class="data-display">
            <h3>Candidates</h3>
            <div id="candidateList">Loading...</div>
        </div>
        
        <div class="data-display">
            <h3>Formations</h3>
            <div id="formationList">Loading...</div>
        </div>
        
        <div class="data-display">
            <h3>Payments</h3>
            <div id="paymentList">Loading...</div>
        </div>
    </div>

    <script type="module">
        import DatabaseManager from './src/utils/database.js';
        
        let dbManager;
        
        // Initialize database manager
        function initDB() {
            try {
                dbManager = new DatabaseManager();
                updateDataDisplay();
                showStatus('Database manager initialized successfully', 'success');
            } catch (error) {
                showStatus('Error initializing database: ' + error.message, 'error');
            }
        }
        
        // Update data display
        function updateDataDisplay() {
            if (!dbManager) return;
            
            try {
                const counts = dbManager.getDataCounts();
                
                document.getElementById('candidateCount').textContent = counts.candidates;
                document.getElementById('formationCount').textContent = counts.formations;
                document.getElementById('paymentCount').textContent = counts.payments;
                document.getElementById('sampleDataStatus').textContent = counts.sampleDataCleared ? 'Yes' : 'No';
                
                // Update detailed lists
                updateCandidateList();
                updateFormationList();
                updatePaymentList();
                
            } catch (error) {
                showStatus('Error updating display: ' + error.message, 'error');
            }
        }
        
        // Update candidate list
        function updateCandidateList() {
            if (!dbManager) return;
            
            const candidates = dbManager.getAllCandidates();
            const listElement = document.getElementById('candidateList');
            
            if (candidates.length === 0) {
                listElement.innerHTML = '<p>No candidates found</p>';
                return;
            }
            
            const html = candidates.map(c => 
                `<div class="data-item">
                    <span>${c.firstName} ${c.lastName} (${c.cin})</span>
                    <span>Status: ${c.status}</span>
                </div>`
            ).join('');
            
            listElement.innerHTML = html;
        }
        
        // Update formation list
        function updateFormationList() {
            if (!dbManager) return;
            
            const formations = dbManager.getAllFormations();
            const listElement = document.getElementById('formationList');
            
            if (formations.length === 0) {
                listElement.innerHTML = '<p>No formations found</p>';
                return;
            }
            
            const html = formations.map(f => 
                `<div class="data-item">
                    <span>${f.title}</span>
                    <span>${f.price} TND</span>
                </div>`
            ).join('');
            
            listElement.innerHTML = html;
        }
        
        // Update payment list
        function updatePaymentList() {
            if (!dbManager) return;
            
            const payments = dbManager.getAllPayments();
            const listElement = document.getElementById('paymentList');
            
            if (payments.length === 0) {
                listElement.innerHTML = '<p>No payments found</p>';
                return;
            }
            
            const html = payments.map(p => 
                `<div class="data-item">
                    <span>Payment ${p.id}</span>
                    <span>${p.amount} TND</span>
                </div>`
            ).join('');
            
            listElement.innerHTML = html;
        }
        
        // Test candidate deletion
        window.testCandidateDeletion = function() {
            if (!dbManager) {
                showStatus('Database not initialized', 'error');
                return;
            }
            
            const candidates = dbManager.getAllCandidates();
            if (candidates.length === 0) {
                showStatus('No candidates to delete', 'error');
                return;
            }
            
            const candidateToDelete = candidates[0];
            const success = dbManager.deleteCandidate(candidateToDelete.id);
            
            if (success) {
                showStatus(`Successfully deleted candidate: ${candidateToDelete.firstName} ${candidateToDelete.lastName}`, 'success');
                updateDataDisplay();
            } else {
                showStatus('Failed to delete candidate', 'error');
            }
        };
        
        // Test formation deletion
        window.testFormationDeletion = function() {
            if (!dbManager) {
                showStatus('Database not initialized', 'error');
                return;
            }
            
            const formations = dbManager.getAllFormations();
            if (formations.length === 0) {
                showStatus('No formations to delete', 'error');
                return;
            }
            
            const formationToDelete = formations[0];
            const success = dbManager.deleteFormation(formationToDelete.id);
            
            if (success) {
                showStatus(`Successfully deleted formation: ${formationToDelete.title}`, 'success');
                updateDataDisplay();
            } else {
                showStatus('Failed to delete formation', 'error');
            }
        };
        
        // Test payment deletion
        window.testPaymentDeletion = function() {
            if (!dbManager) {
                showStatus('Database not initialized', 'error');
                return;
            }
            
            const payments = dbManager.getAllPayments();
            if (payments.length === 0) {
                showStatus('No payments to delete', 'error');
                return;
            }
            
            const paymentToDelete = payments[0];
            const success = dbManager.deletePayment(paymentToDelete.id);
            
            if (success) {
                showStatus(`Successfully deleted payment: ${paymentToDelete.amount} TND`, 'success');
                updateDataDisplay();
            } else {
                showStatus('Failed to delete payment', 'error');
            }
        };
        
        // Clear sample data
        window.clearSampleData = function() {
            if (!dbManager) {
                showStatus('Database not initialized', 'error');
                return;
            }
            
            const success = dbManager.clearSampleData();
            if (success) {
                showStatus('Sample data cleared successfully', 'success');
                updateDataDisplay();
            } else {
                showStatus('Failed to clear sample data', 'error');
            }
        };
        
        // Reset all data
        window.resetData = function() {
            if (!dbManager) {
                showStatus('Database not initialized', 'error');
                return;
            }
            
            const success = dbManager.forceResetAllData();
            if (success) {
                showStatus('All data reset successfully', 'success');
                updateDataDisplay();
            } else {
                showStatus('Failed to reset data', 'error');
            }
        };
        
        // Refresh data
        window.refreshData = function() {
            updateDataDisplay();
            showStatus('Data refreshed', 'success');
        };
        
        // Show status message
        function showStatus(message, type = 'success') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusElement.textContent = '';
                statusElement.className = 'status';
            }, 5000);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initDB);
    </script>
</body>
</html>
